

# 13.vue-quill-editor添加图片上功能



## 1. 主干代码



```vue
<template>
  <div>
    <quill-editor
      ref="quillEditor"
      :content="formValue"
      :options="{
        modules: {
          toolbar: {
            container: toolbarOptios,
            handlers: {
              image: handleImageClick,
            },
          },
        },
      }"
      @change="onChange($event)"
    ></quill-editor>

    <input
      ref="inputImage"
      type="file"
      :accept="accept.toString()"
      style="display: none"
      multiple
      @change="handleChange"
    />
  </div>
</template>

<script>
export default {
  data () {
    return {
      formValue: "",
      accept: ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
      toolbarOptios: [
        [{ header: [1, 2, 3, 4, 5, false] }],
        ['bold'], 
        ['italic'], 
        ['underline'], 
        ['strike'], 
        [{ color: [] }, { background: [] }], 
        [{ list: 'ordered' }, { list: 'bullet' }], 
        ['image']
      ],
    }
  },
  methods: {


    handleImageClick () {

      // ！！这里调用上传接口，将返回的url做处理即可
      // 下方的方法，其实就是quill插入文内容的方法，
      // 核心逻辑：找到当前光标所在的位置，然后创建一个图片标签，插入到富文本中
      const quill = this.$refs.quillEditor.quill
      const length = quill.getSelection().index
      quill.insertEmbed(length, 'image', url)
      quill.setSelection(length + 1)
    }
  }
}
</script>

<style>
</style>
```





## 核心逻辑说明：

自定义toolbarOptios的配置项，除了插件自带的配置项以外，我们重写图片上传的点击事件：`handleImageClick`;

上传图片的事件，主要就是做调用上传接口，获取图片上传后的URL链接，插入到我们的富文本中即可，